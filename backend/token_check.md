# ğŸ“‚ ëª©ë¡

- ğŸŒ [ë‹¤êµ­ì–´ ì§€ì›](./i18n_data.md)
- ğŸ› ï¸ [ORM ì‚¬ìš© (With SqlAlchemy)](./orm.md)
- ğŸ” [Google ë¡œê·¸ì¸ ë„ì…ê¸°: ì‚¬ìš©ì í”¼ë“œë°±ìœ¼ë¡œ ì‹œì‘ëœ ë³€í™”](./token_check.md)

# ğŸ” Google ë¡œê·¸ì¸ ë„ì…ê¸°: ì‚¬ìš©ì í”¼ë“œë°±ìœ¼ë¡œ ì‹œì‘ëœ ë³€í™”

## ğŸ§­ ë¡œê·¸ì¸ ê¸°ëŠ¥ì˜ ì‹œì‘

ì²˜ìŒ ê°œë°œì„ ì‹œì‘í•  ë•ŒëŠ” **ë¡œê·¸ì¸ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.**

ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ìë“¤ì˜ í”¼ë“œë°±ì„ ë°›ìœ¼ë©´ì„œ,

**ì‚¬ìš©ì ê°œì¸ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì˜ í•„ìš”ì„±**ì„ ëŠë¼ê²Œ ë˜ì—ˆê³ , ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë„ì…í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ’¾ ì‚¬ìš©ì ë°ì´í„° ì €ì¥ í•­ëª©

ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ í†µí•´ ì‚¬ìš©ìë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- user_info : ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´
- user_hideout : ì‚¬ìš©ì ì€ì‹ ì²˜ ì •ë³´
- user_quest : ì‚¬ìš©ì í€˜ìŠ¤íŠ¸ í”Œë˜ë„ˆ ì •ë³´
- user_roadmap : ì‚¬ìš©ì ë¡œë“œë§µ ì •ë³´

ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **ìì‹ ì˜ ê²Œì„ ë‚´ ì§„í–‰ ìƒí™©ì„ ì†ì‰½ê²Œ ì €ì¥ ë° í™•ì¸**í•  ìˆ˜ ìˆìœ¼ë©°,

**ëª©í‘œ ì„¤ì • ë° ì§„ë¡œ íƒìƒ‰ì—ë„ ë„ì›€ì´ ë˜ëŠ” ê²½í—˜ì„ ì œê³µ**í•œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

# ğŸŒ Google && Naver ì¸ì¦

## ğŸ“Œ ì´ˆê¸°ì—ëŠ” ë‘ ê°€ì§€ ì¸ì¦ ë°©ì‹ ë„ì…

ê°œë°œ ì´ˆê¸°ì—ëŠ” **Googleê³¼ Naver, ì´ ë‘ ê°€ì§€ OAuth ì¸ì¦ ë°©ì‹ì„ ë™ì‹œì— ë„ì…**í–ˆìŠµë‹ˆë‹¤.

ìµœê·¼ì— ë‹¤êµ­ì–´ë¥¼ ì§€ì›í•˜ë©´ì„œ **í•´ì™¸ì—ëŠ” naverê°€ ì—†ìœ¼ë‹ˆ ê²°ë¡ ì ìœ¼ë¡œëŠ” ì¢‹ì€ ì„ íƒ**ì´ì—ˆë‹¤ ìƒê°í•©ë‹ˆë‹¤.

## ğŸ“Š ì‚¬ìš©ì ì„ íƒê³¼ ì¸ì¦ ë°©ì‹ í†µí•©

í•˜ì§€ë§Œ ì‹¤ì œ ìš´ì˜ ë°ì´í„°ë¥¼ í†µí•´ í™•ì¸í•œ ê²°ê³¼, **ëŒ€ë‹¤ìˆ˜ì˜ ì‚¬ìš©ìë“¤ì´ Google ë¡œê·¸ì¸ì„ ì„ íƒ**í•˜ê³  ìˆì—ˆìœ¼ë©°,

ë‘ ì¸ì¦ ì‹œìŠ¤í…œì„ ë™ì‹œì— ìœ ì§€í•˜ëŠ” ê²ƒì´ **ê´€ë¦¬ ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì **ì´ë¼ íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ì¸ì¦ ë°©ì‹ì„ Googleë¡œ ë‹¨ì¼í™”í•˜ì˜€ìŠµë‹ˆë‹¤.

## ğŸŒ ë‹¤êµ­ì–´ ë° ê¸€ë¡œë²Œ ì§€ì›ì„ ìœ„í•œ ì¢‹ì€ ì„ íƒ

ìµœê·¼ ë‹¤êµ­ì–´(í•œêµ­ì–´, ì˜ì–´, ì¼ë³¸ì–´ ë“±)ë¥¼ ì§€ì›í•˜ê¸° ì‹œì‘í•˜ë©´ì„œ, **í•´ì™¸ ì‚¬ìš©ì ì…ì¥ì—ì„œ Naver ì¸ì¦ì€ ìµìˆ™í•˜ì§€ ì•Šë‹¤**ëŠ” ì ë„ ê³ ë ¤í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ Google í•˜ë‚˜ë¡œ í†µì¼í•œ ê²°ì •ì€ **ê¸€ë¡œë²Œ í™•ì¥ì„±ê³¼ ê´€ë¦¬ íš¨ìœ¨ì„± ì¸¡ë©´ì—ì„œ ì˜¬ë°”ë¥¸ ë°©í–¥ì´ì—ˆë‹¤ê³  íŒë‹¨**í•©ë‹ˆë‹¤.

**ì´ˆê¸°**

```python
import requests
from fastapi import FastAPI, HTTPException


NAVER_USER_INFO_URL = "https://openapi.naver.com/v1/nid/me"
GOOGLE_TOKEN_INFO_URL = "https://www.googleapis.com/oauth2/v1/tokeninfo"


class UserUtil:

    @staticmethod
    def verify_token(provider: str, access_token: str):
        """
        1ì°¨ í† í° ë¶„ë¥˜
        """
        if provider == "naver":
            res = UserUtil.verify_naver_token(access_token)
            if res:
                return res
            else:
                return False
        else:
            res = UserUtil.verify_google_token(access_token)
            if res:
                return res
            else:
                return False

    @staticmethod
    def verify_naver_token(access_token: str):
        """
        naver ê²€ì¦
        """
        headers = {
            "Authorization": f"Bearer {access_token}",
        }
        response = requests.get(NAVER_USER_INFO_URL, headers=headers)

        if response.status_code != 200:
            raise HTTPException(status_code=401, detail="Invalid Naver access token")
        data = response.json()
        return data["response"]["email"]

    @staticmethod
    def verify_google_token(access_token: str):
        """
        êµ¬ê¸€ ê²€ì¦
        """
        response = requests.get(f"{GOOGLE_TOKEN_INFO_URL}?access_token={access_token}")

        if response.status_code != 200:
            raise HTTPException(status_code=401, detail="Invalid Google access token")
        data = response.json()
        return data["email"]
```

**ìˆ˜ì •**

```python
import requests
import os
from dotenv import load_dotenv


load_dotenv()


class UserUtil:
    @staticmethod
    def verify_google_token(access_token: str):
        """
        êµ¬ê¸€ ê²€ì¦
        """
        response = requests.get(
            f"{os.getenv('GOOGLE_TOKEN_INFO_URL')}?access_token={access_token}"
        )

        if response.status_code != 200:
            return False
        data = response.json()
        return data["email"]

```

# ğŸªª Google Token With Header

êµ¬ê¸€ì—ì„œ ë°œê¸‰í•œ **OAuth Tokenì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°±ì—”ë“œë¡œ ì „ë‹¬í•  ë•Œ**,
ì²˜ìŒì—ëŠ” **HTTP Headerë¥¼ í†µí•´ ì „ë‹¬**í•˜ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ìƒê°ì²˜ëŸ¼ ì˜ ë™ì‘í•˜ì§€ ì•Šì•„ ë§ì€ ì‹œê°„ì„ ë“¤ì—¬ ì‚½ì§ˆì„ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê²°êµ­ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸´ í–ˆì§€ë§Œ,
**í•´ê²° ë°©ë²•ì´ ì˜ˆìƒ ì™¸ë¡œ ë„ˆë¬´ ë‹¨ìˆœí•˜ê³  ëª…í™•í•´ì„œ í—ˆíƒˆí–ˆë˜ ê²½í—˜**ì´ì—ˆìŠµë‹ˆë‹¤.

```python
from fastapi import APIRouter, Depends
from api.response import CustomResponse
from fastapi.security import OAuth2PasswordBearer
from util.constants import HTTPCode
from api.constants import Message
from api.user.service import UserService
from api.user.user_req_models import AddUserReq
from api.user.util import UserUtil

router = APIRouter(tags=["User"])

# JWTë¥¼ í—¤ë”ì—ì„œ ì¶”ì¶œí•˜ëŠ” ì˜ì¡´ì„± í•¨ìˆ˜
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")

@router.post("/get")
def get_user(token: str = Depends(oauth2_scheme)):

    user_email = UserUtil.verify_google_token(access_token=token)
    if user_email:
        user = UserService.get_user(user_email)
        if user is None:
            return CustomResponse.response(None, HTTPCode.OK, Message.INVALID_USER)
        return CustomResponse.response(user, HTTPCode.OK, Message.SUCCESS)
    else:
        return CustomResponse.response(None, HTTPCode.OK, Message.INVALID_USER)
```
